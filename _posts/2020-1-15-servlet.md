---
layout: post
title: Servlet使用
categories: Web
tags : Web
author: 彭浩
---

## 实现Servlet的方式

（1）实现javax.servlet.Servlet接口
（2）继承javax.servlet.GenericServlet类
（3）继承javax.servlet.http.HttpServlet类

## Servlet五个方法

（1）void init(ServletConfig)启动时调用，只调用一次
（2）void destroy()，销毁前调用，只调用一次
（3）service(ServletRequest, ServletResponse)，每次请求处理时都会调用
（4）getServiceConfig，获取Servlet配置
（5）getServiceInfo，获取Servlet的信息

## Servlet访问

* 给Servlet配置Servlet路径，需要在Web.xml中对Servlet进行配置
```xml
<Servlet>
    <servlet-name>xxx</servlet-name>
    <servlet-class>xxx</servlet-class>
</Servlet>
<servlet-mapping>
    <servlet-name>xxx</servlet-name>
    <url-pattern>/xxx/Aservlet</url-pattern>
</servlet-mapping>
```

## ServletConfig

1个ServletConfig对象，对应一段Web.xml中的Servlet的配置信息

* ServletConfig对象存在的方法

（1）String getServletName()，获取的是<servlet-name>中的内容  
（2）ServletContex getServletContex()，获取Servlet的上下文对象  
（3）String getInitParameter(String name)，通过名称获取指定初始化参数的值  
（4）Enumeration getParameterNames()，获取所有初始化参数的名称
```java
<init-para>
<para-name>p1</param-name>
<param-value>v1</param-value>
</init-param>
```

## GenericServlet
是一个抽象类，已经封装好ServletConfig相关的操作

## HTTPServlet

（1）void Service(HTTPServletRequest, HTTPServletResponse)，该函数会通过Request得到当前请求的请求方式，例如：Get或Post，根据请求调用doGet或者doPost
（2）若自己写的Servlet未覆盖HTTPServlet的doGet或者doPost等关于请求方式的代码，则会返回405


## Servlet相关

* Servlet是否是线程安全的

Servlet是非线程安全的，但是效率高，所以

（1）不要在Servlet中添加成员变量，尽量使用局部变量  
（2）可以创建无状态成员  
（3）可以创建有状态成员，但状态必须为只读的


* Servlet加载时机

默认情况下，服务器会在某个Servlet第一次收到请求是创建，也可以在web.xml中对Servlet进行配置，使服务器启动时就加载，具体如下
```xml
<sevlet>
    <servlet-name>hello1</servlet-name>
    <servlet-class>XXX</servlet-class>
    <load-on-startup>0</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name></servlet-name>
    <url-pattern></url-pattern>
</servlet-mapping>
```

* url-pattern

（1）一个Servlet可以有多个  
（2）可以使用通配符，“*”可以匹配任何URL前缀或后缀，使用通配符可以命名一个Servlet绑定一组URL如

    <url-pattern>/servlet/*</url-pattern>：/servlet/a、/servlet/b都匹配，这是前缀匹配

    <url-pattern>*.do</url-pattern>：这是后缀匹配

    <url-pattern>/*</url-pattern>：匹配所有URL

    注意，通配符要么为前缀，要么为后缀，不能出现在中间位置，也不能只有通配符，同时一个URL中最多只有一个通配符

    注意，访问路径会优先匹配具体的URL，然后才是模糊匹配

* web.xml文件的继承

（1）在TomCat的conf文件夹下可以看到四个xml文件，其中web.xml文件就是我们自己写的web.xml的父亲，相当于写在每个Servlet中的web.xml中  
（2）当访问路径不存在时，会走父亲web.xml中的映射的Servlet，而该Servlet处理返回404错误  
（3）默认的行为，包括JSP路径访问，session-config等都是在父亲web.xml中配置的

## 