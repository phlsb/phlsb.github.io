---
layout: post
title: Java Web三大组件之过滤器和监听器
categories: Web
tags : Web
author: 彭浩
---

## 过滤器

（1）它会在一组资源（JSP、Servlet、CSS等）的前面执行，可以让请求得到目标资源也可以不让请求到达，有拦截请求的功能

（2）写法：

* 写一个类实现Filter接口
* 在web.xml中配置
* Filter接口

      void init(FilterConfig)创建之后马上执行，会在服务器启动时就创建
      void destroy()销毁之前执行，在服务器关闭时执行
      void doFilter(ServletRequest, ServletResponse, FilterChain)每次过滤时都会执行
      Filter是单例的

* web.xml配置，也可以直接将<url-pattern>替换为<servlet-name>也可以，针对性强，就拦截该Servlet
```xml
<filter>
    <filter-name>XXX</filter-name>
    <filter-class>XXX</filter-class>
</filter>
<filter-mapping>
    <filter-name>XXX</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>
```

* FilterConfig与ServletConfig类似，有如下几个API

      String getInitParameter(String name)
      Enumeration getInitParameterNames()
      ServletContext getServletContex()
      String getFilterName()

* FilterChain，仅有一个方法如下

      doFilter(ServletRequest, ServletResponse)作用为放行，相当于调用目标资源的Servlet的service方法

（3）多个Filter的顺序

* FilterChain#doFilter方法是执行目标资源或者执行下一个过滤器，如果没有下一个过滤器就执行目标资源否则执行过滤器

（4）四种拦截顺序

* 请求 REQUEST
* 转发 FORWARD
* 包含 INCLUDE
* 错误 ERROR

在<filter-mapping>中进行配置
```xml
<filter-mapping>
    <filter-name>XXX</filter-name>
    <url-pattern>/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>FORWARD</dispatcher>
    <dispatcher>INCLUDE</dispatcher>
    <dispatcher>ERROR</dispatcher>
</filter-mapping>
```

（5）如何控制多个过滤器的执行顺序，<filter-mapping>的配置顺序决定了过滤器的执行顺序

（6）过滤器的应用场景

* 执行目标资源之前做预处理工作，例如设置编码（几乎所有的Servlet都要写request.setCharacterEncoding()，可以将其放入一个filter中），这种通常会放行，只是在目标资源执行之前做一些工作
* 通过条件判断是否放行，例如校验当前用户是否已经登录，或者用户IP是否已经被禁用
* 在目标资源执行后，做一些后续特殊处理工作，例如将目标资源输出的数据进行处理